---
title: "r_01_analisis"
author: "Diego Reyes"
date: '2022-07-02'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Cargar librerías
```{r, echo = FALSE}
pacman::p_load(sjPlot,
               tidyverse,
               srvyr,
               survey,
               magrittr)
```

# 2. Cargar datos
```{r, echo = FALSE}
datos_proc <- readRDS(file= "../output/data/datos_proc.rds")

```

# 3. Visualizar datos
```{r, echo = FALSE}
sjPlot::view_df(datos_proc,
                encoding = "UTF-8")


```

# 4. Análisis de Correlación
```{r, echo=FALSE, message=FALSE}

datos_proc%>%
  plot_scatter(., confianza_policia, sexo,
               title="Asociación de variables percepcion de riesgo y cuidarse",
               fit.grps = "lm", grid = TRUE)

```

## 4.1 Tabla del análisis de correlación
```{r}

datos_proc %>%
  select( confianza_policia,  sexo) %>% 
  tab_corr(.,
           triangle = "lower",   
           title = "Tabla de correlación",
           encoding = "UTF-8")
```


```{r, echo=FALSE,message=FALSE}
modelo1 <- lm(confianza_policia ~  sexo + edad,
              data = datos_proc, 
              weights = Ponderador)

summary(modelo1)

modelo2 <- lm(confianza_iglesia ~ sexo + edad,
              data = datos_proc,
              weights = Ponderador)

summary(modelo2)

modelo3 <- lm(confianza_congreso ~ sexo + edad,
              data = datos_proc,
              weights = Ponderador)

summary(modelo3)

modelo4 <- lm(confianza_gobierno ~ sexo + edad,
              data = datos_proc,
              weights = Ponderador)

summary(modelo4)






```

#tTabla con los modelos hechos 
```{r} 
sjPlot::tab_model(list(modelo1, modelo2, modelo3, modelo4),
                  show.ci = FALSE,
                  collapse.ci = T,
                  p.style = "stars",
                  title = "Modelos de regresion lineal multiple",
                  digits = 3,
                  show.reflvl = TRUE,
                  encoding = "UTF-8",
                  lang = "es")

sjPlot::tab_model(list(modelo1,modelo2,modelo3,modelo4),
  string.intercept = "(Intercepto)",
  string.pred = "Predictores",
  p.style = "stars",
  show.ci = FALSE,
  collapse.ci = T,
  digits = 3,
  dv.labels = c("Modelo 1", "Modelo 2","Modelo 3","Modelo 4"),
  show.reflvl = TRUE,
  encoding = "UTF-8",
  lang = "es")
```


# Creamos un modelo completo sin diseño muestral
```{r modelo_completo_sin, echo=TRUE}

modelo_ponderador <- lm(confianza_policia ~ confianza_iglesia + confianza_congreso + confianza_gobierno + sexo + edad, data = datos_proc, weights = Ponderador)

summary(modelo_ponderador) #Revisamos los valores del modelo
```

# Creamos un modelo sin pesos muestrales
```{r model0, echo=TRUE}
modelo0 <- lm(confianza_policia ~ confianza_iglesia + confianza_congreso + confianza_gobierno + sexo + edad, data = datos_proc)
```



**Tabla con modelo completo con peso muestral y el modelo completo sin pesos muestrales**

```{r tabla3, echo=FALSE, include=TRUE}
sjPlot::tab_model(list(modelo_ponderador,modelo0),
  string.intercept = "(Intercepto)",
  string.pred = "Predictores",
  p.style = "stars",
  show.ci = FALSE,
  collapse.ci = T,
  digits = 3,
  dv.labels = c("Modelo con pesos muestrales", "Modelo sin pesos muestrales"),
  show.reflvl = TRUE,
  encoding = "UTF-8",
  lang = "es")
```
```


```{r}
5. Gráfico para Modelo Ponderador sin diseño muestral  
```{r grafico1, echo=FALSE}
plot_model(modelo_ponderador, type = c("est"),
  show.intercept = T,
  show.values = T,
  show.p = T,
  digits = 3,
  vline.color = "purple",
  title = "Modelo de regresión lineal para Modelo Completo")
```

5.1 Gráfico para Modelo 0 sin peso muetsral 
```{r grafico2}
plot_model(modelo0, type = c("est"),
  show.intercept = T,
  show.values = T,
  show.p = T,
  digits = 3,
  vline.color = "yellow",
  title = "Modelo de regresión lineal simple para Modelo 0 sin peso muestral")
```

